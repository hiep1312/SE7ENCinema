<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý Biến thể</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .variant-manager {
            background: rgba(40, 40, 40, 0.95);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .variant-manager h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #ffffff;
            font-weight: 600;
            font-size: 28px;
        }

        /* Time Controls */
        .time-controls {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(30, 30, 30, 0.8);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .time-button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .time-btn {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: rgba(60, 60, 60, 0.8);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
        }

        .time-btn:hover {
            background: rgba(70, 70, 70, 0.9);
            border-color: #4a9eff;
            transform: translateY(-2px);
        }

        .time-btn.active {
            border-color: #4a9eff;
            background: rgba(74, 158, 255, 0.1);
        }

        .time-icon {
            color: #4a9eff;
            flex-shrink: 0;
        }

        .time-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            text-align: left;
        }

        .time-label {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 4px;
        }

        .time-value {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
        }

        .time-range-display {
            text-align: center;
            padding: 15px;
            background: rgba(74, 158, 255, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(74, 158, 255, 0.2);
        }

        .range-text {
            color: #4a9eff;
            font-weight: 500;
        }

        /* Add Variant Section */
        .add-variant-section {
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(30, 30, 30, 0.6);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .add-variant-section h3 {
            color: #ffffff;
            margin-bottom: 20px;
            font-size: 20px;
        }

        .variant-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            color: #ffffff;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px 16px;
            background: rgba(60, 60, 60, 0.8);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #ffffff;
            font-size: 14px;
            transition: all 0.3s ease;
            outline: none;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #4a9eff;
            background: rgba(70, 70, 70, 0.9);
            box-shadow: 0 0 0 3px rgba(74, 158, 255, 0.2);
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #aaa;
        }

        .form-group select option {
            background: #3c3c3c;
            color: #ffffff;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 10px;
        }

        /* Buttons */
        .btn-primary,
        .btn-secondary,
        .btn-danger {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
        }

        .btn-primary {
            background: #4a9eff;
            color: #ffffff;
        }

        .btn-primary:hover {
            background: #3a8eef;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .btn-danger {
            background: rgba(255, 74, 74, 0.2);
            color: #ff4a4a;
            border: 1px solid rgba(255, 74, 74, 0.3);
        }

        .btn-danger:hover {
            background: rgba(255, 74, 74, 0.3);
            transform: translateY(-1px);
        }

        /* Variants List */
        .variants-list-section {
            background: rgba(30, 30, 30, 0.6);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .list-header h3 {
            color: #ffffff;
            font-size: 18px;
        }

        .list-actions {
            display: flex;
            gap: 10px;
        }

        .variants-container {
            max-height: 400px;
            overflow-y: auto;
        }

        .variants-list {
            padding: 20px;
        }

        /* Custom Scrollbar */
        .variants-container::-webkit-scrollbar {
            width: 8px;
        }

        .variants-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }

        .variants-container::-webkit-scrollbar-thumb {
            background: rgba(74, 158, 255, 0.6);
            border-radius: 4px;
        }

        /* Variant Item */
        .variant-item {
            background: rgba(60, 60, 60, 0.6);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            animation: slideIn 0.3s ease;
        }

        .variant-item:hover {
            background: rgba(70, 70, 70, 0.8);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .variant-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .variant-title {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .variant-name {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
        }

        .variant-type {
            font-size: 12px;
            color: #4a9eff;
            background: rgba(74, 158, 255, 0.2);
            padding: 4px 8px;
            border-radius: 12px;
            width: fit-content;
        }

        .variant-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 6px;
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .action-btn.delete:hover {
            background: rgba(255, 74, 74, 0.3);
            color: #ff4a4a;
        }

        .variant-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .detail-label {
            font-size: 12px;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detail-value {
            font-size: 14px;
            color: #ffffff;
            font-weight: 500;
        }

        .variant-description {
            color: #ccc;
            font-size: 14px;
            line-height: 1.5;
            margin-top: 10px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .variant-timestamp {
            font-size: 12px;
            color: #888;
            text-align: right;
            margin-top: 10px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }

        .empty-icon {
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state p {
            font-size: 18px;
            margin-bottom: 8px;
        }

        .empty-state small {
            font-size: 14px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: rgba(40, 40, 40, 0.95);
            border-radius: 16px;
            width: 90%;
            max-width: 400px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: modalSlideIn 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-header h3 {
            color: #ffffff;
            font-size: 18px;
        }

        .close-btn {
            background: none;
            border: none;
            color: #aaa;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }

        .modal-body {
            padding: 25px;
        }

        .datetime-picker {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .date-picker,
        .time-picker {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .date-picker label,
        .time-picker label {
            color: #ffffff;
            font-weight: 500;
            font-size: 14px;
        }

        .date-picker input,
        .time-picker input {
            padding: 12px 16px;
            background: rgba(60, 60, 60, 0.8);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #ffffff;
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
        }

        .date-picker input:focus,
        .time-picker input:focus {
            border-color: #4a9eff;
            background: rgba(70, 70, 70, 0.9);
            box-shadow: 0 0 0 3px rgba(74, 158, 255, 0.2);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            padding: 20px 25px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .variant-manager {
                padding: 20px;
            }

            .time-button-group {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .list-header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .list-actions {
                justify-content: center;
            }

            .variant-details {
                grid-template-columns: 1fr;
            }

            .variant-header {
                flex-direction: column;
                gap: 15px;
            }

            .variant-actions {
                align-self: flex-start;
            }
        }

        @media (max-width: 480px) {
            .time-btn {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }

            .form-actions {
                flex-direction: column;
            }

            .list-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="variant-manager">
            <h2>Quản lý Biến thể</h2>

            <!-- Time Controls -->
            <div class="time-controls">
                <div class="time-button-group">
                    <button class="time-btn" id="startTimeBtn">
                        <div class="time-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12,6 12,12 16,14"></polyline>
                            </svg>
                        </div>
                        <div class="time-info">
                            <span class="time-label">Thời gian bắt đầu</span>
                            <span class="time-value" id="startTimeValue">Chưa chọn</span>
                        </div>
                    </button>

                    <button class="time-btn" id="endTimeBtn">
                        <div class="time-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12,6 12,12 8,14"></polyline>
                            </svg>
                        </div>
                        <div class="time-info">
                            <span class="time-label">Thời gian kết thúc</span>
                            <span class="time-value" id="endTimeValue">Chưa chọn</span>
                        </div>
                    </button>
                </div>

                <div class="time-range-display" id="timeRangeDisplay">
                    <span class="range-text">Chưa thiết lập khoảng thời gian</span>
                </div>
            </div>

            <!-- Add Variant Form -->
            <div class="add-variant-section">
                <h3>Thêm Biến thể Mới</h3>

                <form class="variant-form" id="variantForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="variantName">Tên biến thể</label>
                            <input type="text" id="variantName" placeholder="Nhập tên biến thể..." required>
                        </div>

                        <div class="form-group">
                            <label for="variantType">Loại biến thể</label>
                            <select id="variantType" required>
                                <option value="">Chọn loại</option>
                                <option value="color">Màu sắc</option>
                                <option value="size">Kích thước</option>
                                <option value="material">Chất liệu</option>
                                <option value="style">Phong cách</option>
                                <option value="other">Khác</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="variantValue">Giá trị</label>
                            <input type="text" id="variantValue" placeholder="Nhập giá trị..." required>
                        </div>

                        <div class="form-group">
                            <label for="variantPrice">Giá (VNĐ)</label>
                            <input type="number" id="variantPrice" placeholder="0" min="0">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="variantStock">Số lượng tồn kho</label>
                            <input type="number" id="variantStock" placeholder="0" min="0">
                        </div>

                        <div class="form-group">
                            <label for="variantSku">Mã SKU</label>
                            <input type="text" id="variantSku" placeholder="SKU-001">
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label for="variantDescription">Mô tả</label>
                        <textarea id="variantDescription" placeholder="Mô tả chi tiết về biến thể..." rows="3"></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" id="resetForm">Đặt lại</button>
                        <button type="submit" class="btn-primary">Thêm biến thể</button>
                    </div>
                </form>
            </div>

            <!-- Variants List -->
            <div class="variants-list-section">
                <div class="list-header">
                    <h3>Danh sách Biến thể (<span id="variantCount">0</span>)</h3>
                    <div class="list-actions">
                        <button class="btn-secondary" id="exportBtn">Xuất dữ liệu</button>
                        <button class="btn-danger" id="clearAllBtn">Xóa tất cả</button>
                    </div>
                </div>

                <div class="variants-container">
                    <div class="variants-list" id="variantsList">
                        <div class="empty-state">
                            <div class="empty-icon">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="9" y1="9" x2="15" y2="15"></line>
                                    <line x1="15" y1="9" x2="9" y2="15"></line>
                                </svg>
                            </div>
                            <p>Chưa có biến thể nào được tạo</p>
                            <small>Thêm biến thể đầu tiên để bắt đầu</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Time Picker Modal -->
    <div class="modal" id="timeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Chọn thời gian</h3>
                <button class="close-btn" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="datetime-picker">
                    <div class="date-picker">
                        <label for="datePicker">Ngày</label>
                        <input type="date" id="datePicker">
                    </div>
                    <div class="time-picker">
                        <label for="timePicker">Giờ</label>
                        <input type="time" id="timePicker">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelTime">Hủy</button>
                <button class="btn-primary" id="confirmTime">Xác nhận</button>
            </div>
        </div>
    </div>

    <script>
        class VariantManager {
    constructor() {
        this.variants = [];
        this.startTime = null;
        this.endTime = null;
        this.currentTimeType = null;

        this.initializeElements();
        this.bindEvents();
        this.loadFromStorage();
        this.updateDisplay();
    }

    initializeElements() {
        // Time controls
        this.startTimeBtn = document.getElementById('startTimeBtn');
        this.endTimeBtn = document.getElementById('endTimeBtn');
        this.startTimeValue = document.getElementById('startTimeValue');
        this.endTimeValue = document.getElementById('endTimeValue');
        this.timeRangeDisplay = document.getElementById('timeRangeDisplay');

        // Form elements
        this.variantForm = document.getElementById('variantForm');
        this.variantName = document.getElementById('variantName');
        this.variantType = document.getElementById('variantType');
        this.variantValue = document.getElementById('variantValue');
        this.variantPrice = document.getElementById('variantPrice');
        this.variantStock = document.getElementById('variantStock');
        this.variantSku = document.getElementById('variantSku');
        this.variantDescription = document.getElementById('variantDescription');
        this.resetFormBtn = document.getElementById('resetForm');

        // List elements
        this.variantsList = document.getElementById('variantsList');
        this.variantCount = document.getElementById('variantCount');
        this.exportBtn = document.getElementById('exportBtn');
        this.clearAllBtn = document.getElementById('clearAllBtn');

        // Modal elements
        this.timeModal = document.getElementById('timeModal');
        this.modalTitle = document.getElementById('modalTitle');
        this.datePicker = document.getElementById('datePicker');
        this.timePicker = document.getElementById('timePicker');
        this.closeModal = document.getElementById('closeModal');
        this.cancelTime = document.getElementById('cancelTime');
        this.confirmTime = document.getElementById('confirmTime');
    }

    bindEvents() {
        // Time button events
        this.startTimeBtn.addEventListener('click', () => this.openTimeModal('start'));
        this.endTimeBtn.addEventListener('click', () => this.openTimeModal('end'));

        // Form events
        this.variantForm.addEventListener('submit', (e) => this.handleFormSubmit(e));
        this.resetFormBtn.addEventListener('click', () => this.resetForm());

        // List action events
        this.exportBtn.addEventListener('click', () => this.exportData());
        this.clearAllBtn.addEventListener('click', () => this.clearAllVariants());

        // Modal events
        this.closeModal.addEventListener('click', () => this.closeTimeModal());
        this.cancelTime.addEventListener('click', () => this.closeTimeModal());
        this.confirmTime.addEventListener('click', () => this.confirmTimeSelection());

        // Close modal when clicking outside
        this.timeModal.addEventListener('click', (e) => {
            if (e.target === this.timeModal) {
                this.closeTimeModal();
            }
        });

        // Auto-generate SKU
        this.variantName.addEventListener('input', () => this.generateSKU());
        this.variantType.addEventListener('change', () => this.generateSKU());
    }

    openTimeModal(type) {
        this.currentTimeType = type;
        this.modalTitle.textContent = type === 'start' ? 'Chọn thời gian bắt đầu' : 'Chọn thời gian kết thúc';

        // Set current values if exist
        const currentTime = type === 'start' ? this.startTime : this.endTime;
        if (currentTime) {
            const date = new Date(currentTime);
            this.datePicker.value = date.toISOString().split('T')[0];
            this.timePicker.value = date.toTimeString().slice(0, 5);
        } else {
            // Set default to current date/time
            const now = new Date();
            this.datePicker.value = now.toISOString().split('T')[0];
            this.timePicker.value = now.toTimeString().slice(0, 5);
        }

        this.timeModal.classList.add('show');
    }

    closeTimeModal() {
        this.timeModal.classList.remove('show');
        this.currentTimeType = null;
    }

    confirmTimeSelection() {
        const date = this.datePicker.value;
        const time = this.timePicker.value;

        if (!date || !time) {
            alert('Vui lòng chọn đầy đủ ngày và giờ');
            return;
        }

        const dateTime = new Date(`${date}T${time}`);

        if (this.currentTimeType === 'start') {
            this.startTime = dateTime;
            this.startTimeValue.textContent = this.formatDateTime(dateTime);
            this.startTimeBtn.classList.add('active');
        } else {
            this.endTime = dateTime;
            this.endTimeValue.textContent = this.formatDateTime(dateTime);
            this.endTimeBtn.classList.add('active');
        }

        this.updateTimeRangeDisplay();
        this.closeTimeModal();
        this.saveToStorage();
    }

    formatDateTime(date) {
        return date.toLocaleString('vi-VN', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
        });
    }

    updateTimeRangeDisplay() {
        if (this.startTime && this.endTime) {
            const duration = this.endTime - this.startTime;
            const days = Math.floor(duration / (1000 * 60 * 60 * 24));
            const hours = Math.floor((duration % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));

            let rangeText = `Từ ${this.formatDateTime(this.startTime)} đến ${this.formatDateTime(this.endTime)}`;
            if (days > 0) {
                rangeText += ` (${days} ngày ${hours} giờ)`;
            } else if (hours > 0) {
                rangeText += ` (${hours} giờ)`;
            }

            this.timeRangeDisplay.querySelector('.range-text').textContent = rangeText;
        } else if (this.startTime) {
            this.timeRangeDisplay.querySelector('.range-text').textContent =
                `Bắt đầu từ: ${this.formatDateTime(this.startTime)}`;
        } else if (this.endTime) {
            this.timeRangeDisplay.querySelector('.range-text').textContent =
                `Kết thúc lúc: ${this.formatDateTime(this.endTime)}`;
        } else {
            this.timeRangeDisplay.querySelector('.range-text').textContent =
                'Chưa thiết lập khoảng thời gian';
        }
    }

    generateSKU() {
        const name = this.variantName.value.trim();
        const type = this.variantType.value;

        if (name && type) {
            const nameCode = name.substring(0, 3).toUpperCase();
            const typeCode = type.substring(0, 2).toUpperCase();
            const timestamp = Date.now().toString().slice(-4);
            this.variantSku.value = `${nameCode}-${typeCode}-${timestamp}`;
        }
    }

    handleFormSubmit(e) {
        e.preventDefault();

        const variant = {
            id: Date.now(),
            name: this.variantName.value.trim(),
            type: this.variantType.value,
            value: this.variantValue.value.trim(),
            price: parseFloat(this.variantPrice.value) || 0,
            stock: parseInt(this.variantStock.value) || 0,
            sku: this.variantSku.value.trim(),
            description: this.variantDescription.value.trim(),
            createdAt: new Date(),
            startTime: this.startTime,
            endTime: this.endTime
        };

        this.variants.push(variant);
        this.updateDisplay();
        this.resetForm();
        this.saveToStorage();

        // Show success message
        this.showNotification('Đã thêm biến thể thành công!', 'success');
    }

    resetForm() {
        this.variantForm.reset();
        this.variantSku.value = '';
    }

    updateDisplay() {
        this.variantCount.textContent = this.variants.length;

        if (this.variants.length === 0) {
            this.variantsList.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="9" y1="9" x2="15" y2="15"></line>
                            <line x1="15" y1="9" x2="9" y2="15"></line>
                        </svg>
                    </div>
                    <p>Chưa có biến thể nào được tạo</p>
                    <small>Thêm biến thể đầu tiên để bắt đầu</small>
                </div>
            `;
            return;
        }

        this.variantsList.innerHTML = this.variants.map(variant => this.createVariantHTML(variant)).join('');
    }

    createVariantHTML(variant) {
        const typeLabels = {
            color: 'Màu sắc',
            size: 'Kích thước',
            material: 'Chất liệu',
            style: 'Phong cách',
            other: 'Khác'
        };

        return `
            <div class="variant-item" data-id="${variant.id}">
                <div class="variant-header">
                    <div class="variant-title">
                        <div class="variant-name">${variant.name}</div>
                        <div class="variant-type">${typeLabels[variant.type] || variant.type}</div>
                    </div>
                    <div class="variant-actions">
                        <button class="action-btn" onclick="variantManager.editVariant(${variant.id})" title="Chỉnh sửa">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="m18.5 2.5 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                        </button>
                        <button class="action-btn delete" onclick="variantManager.deleteVariant(${variant.id})" title="Xóa">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3,6 5,6 21,6"></polyline>
                                <path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="variant-details">
                    <div class="detail-item">
                        <div class="detail-label">Giá trị</div>
                        <div class="detail-value">${variant.value}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Giá</div>
                        <div class="detail-value">${variant.price.toLocaleString('vi-VN')} VNĐ</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Tồn kho</div>
                        <div class="detail-value">${variant.stock}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">SKU</div>
                        <div class="detail-value">${variant.sku}</div>
                    </div>
                </div>

                ${variant.description ? `<div class="variant-description">${variant.description}</div>` : ''}

                <div class="variant-timestamp">
                    Tạo lúc: ${this.formatDateTime(variant.createdAt)}
                    ${variant.startTime ? `<br>Thời gian: ${this.formatDateTime(variant.startTime)} - ${variant.endTime ? this.formatDateTime(variant.endTime) : 'Không giới hạn'}` : ''}
                </div>
            </div>
        `;
    }

    editVariant(id) {
        const variant = this.variants.find(v => v.id === id);
        if (!variant) return;

        // Fill form with variant data
        this.variantName.value = variant.name;
        this.variantType.value = variant.type;
        this.variantValue.value = variant.value;
        this.variantPrice.value = variant.price;
        this.variantStock.value = variant.stock;
        this.variantSku.value = variant.sku;
        this.variantDescription.value = variant.description;

        // Remove the variant from list (will be re-added when form is submitted)
        this.deleteVariant(id, false);

        // Scroll to form
        document.querySelector('.add-variant-section').scrollIntoView({ behavior: 'smooth' });
    }

    deleteVariant(id, showConfirm = true) {
        if (showConfirm && !confirm('Bạn có chắc chắn muốn xóa biến thể này?')) {
            return;
        }

        this.variants = this.variants.filter(v => v.id !== id);
        this.updateDisplay();
        this.saveToStorage();

        if (showConfirm) {
            this.showNotification('Đã xóa biến thể!', 'success');
        }
    }

    clearAllVariants() {
        if (!confirm('Bạn có chắc chắn muốn xóa tất cả biến thể?')) {
            return;
        }

        this.variants = [];
        this.updateDisplay();
        this.saveToStorage();
        this.showNotification('Đã xóa tất cả biến thể!', 'success');
    }

    exportData() {
        if (this.variants.length === 0) {
            alert('Không có dữ liệu để xuất');
            return;
        }

        const data = {
            timeRange: {
                startTime: this.startTime,
                endTime: this.endTime
            },
            variants: this.variants,
            exportedAt: new Date()
        };

        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `variants-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        this.showNotification('Đã xuất dữ liệu thành công!', 'success');
    }

    showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${type === 'success' ? '#4a9eff' : '#ff4a4a'};
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            z-index: 10000;
            animation: slideInRight 0.3s ease;
        `;

        document.body.appendChild(notification);

        setTimeout(() => {
            notification.style.animation = 'slideOutRight 0.3s ease';
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 300);
        }, 3000);
    }

    saveToStorage() {
        const data = {
            variants: this.variants,
            startTime: this.startTime,
            endTime: this.endTime
        };
        localStorage.setItem('variantManagerData', JSON.stringify(data));
    }

    loadFromStorage() {
        const data = localStorage.getItem('variantManagerData');
        if (data) {
            try {
                const parsed = JSON.parse(data);
                this.variants = parsed.variants || [];
                this.startTime = parsed.startTime ? new Date(parsed.startTime) : null;
                this.endTime = parsed.endTime ? new Date(parsed.endTime) : null;

                // Update time display
                if (this.startTime) {
                    this.startTimeValue.textContent = this.formatDateTime(this.startTime);
                    this.startTimeBtn.classList.add('active');
                }
                if (this.endTime) {
                    this.endTimeValue.textContent = this.formatDateTime(this.endTime);
                    this.endTimeBtn.classList.add('active');
                }
                this.updateTimeRangeDisplay();
            } catch (e) {
                console.error('Error loading data from storage:', e);
            }
        }
    }
}

// Add CSS animations
const style = document.createElement('style');
style.textContent = `
    @keyframes slideInRight {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOutRight {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
`;
document.head.appendChild(style);

// Initialize the application
let variantManager;
document.addEventListener('DOMContentLoaded', () => {
    variantManager = new VariantManager();
});
    </script>
</body>
</html>
